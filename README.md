# Crypto Spot + Futures Strategy Recommender

Эта программа объединяет данные по **споту** (топ‑50 по капитализации) и **фьючерсам** (перпетуалы и квартальные, где доступны) и автоматически предлагает низкорисковые и рыночно‑нейтральные стратегии (cash‑and‑carry, реверсная cash‑and‑carry, база квартальных, а также тренд с хеджем фьючерсом).

## Что делает
1. Загружает топ‑50 монет по капитализации и их **спот‑цены** (CoinGecko).
2. Для каждой монеты пытается найти соответствующие тикеры на биржах фьючерсов (Binance, Bybit, OKX):
   - Перпетуальные контракты (funding rate, open interest, mark price)
   - Квартальные фьючерсы, если доступны (для оценки годовой базы).
3. Считает метрики:
   - Суточная и 7‑дневная доходность спота
   - Годовая ставка фондирования (перпетуал)
   - Годовая база квартальных фьючерсов (если найдены котировки) 
   - Нормализованный OI/Volume
4. Генерирует **рекомендованные позиции** под заданный капитал:
   - **Cash‑and‑carry**: long spot + short perp (если funding >> 0)
   - **Reverse CnC**: short spot (через margin или short perp) + long perp (если funding << 0)
   - **Quarterly basis**: long spot + short quarterly (если база >> 0)
   - **Trend hedge**: long spot + частичный short perp (delta≈0.5), если есть тренд и умеренное фондирование
5. Делает риск‑паритет между отобранными монетами (инверсия 30‑дневной волы) и ограничение веса одной монеты.

## Быстрый старт
```bash
# 1) Установка зависимостей
python -m venv .venv && . .venv/bin/activate  # (Windows: .venv\Scripts\activate)
pip install -r requirements.txt

# 2) Настройка (опционально)
cp .env.example .env  # если будете использовать ключи/прокси
# отредактируйте config.yaml при необходимости

# 3) Запуск
python -m src.main --capital 10000 --n_coins 50 --funding_pos_thr 0.20 --funding_neg_thr -0.20 --basis_thr 0.10

# 4) Результат
# В консоли: таблица отобранных стратегий и аллокаций
# Также сохраняется CSV в ./runs/latest_recommendations.csv
```
> Пороговые значения указываются в долях (0.20 = 20% годовых).

## Параметры CLI
- `--capital` — объём капитала в USD (default: 10000)
- `--n_coins` — число монет из топа (default: 50)
- `--funding_pos_thr` — порог годового funding для L spot / S perp (default: 0.20)
- `--funding_neg_thr` — порог для reverse (default: -0.20)
- `--basis_thr` — порог годовой базы квартальных (default: 0.10)
- `--max_weight` — макс. вес одной монеты в риск‑паритете (default: 0.35)
- `--vol_lookback` — дни для оценки волатильности (default: 30)
- `--trend_lookback` — дни для тренд‑фильтра (default: 7)

## Источники данных (без ключей)
- **CoinGecko** (спот + топ‑50): публичные эндпоинты (рейт‑лимиты умеренные)
- **Binance Futures**, **Bybit**, **OKX**: публичные REST для funding, OI, mark price, instruments.
> При желании можете добавить свои ключи/API‑прокси в `.env`.

## Важно
- Код делает **best‑effort** сопоставление тикеров между источниками (например, `BTC` → `BTCUSDT` для фьючерсов). Неподдерживаемые или конфликтные тикеры пропускаются.
- Это пример исследовательского ПО, **не инвестиционный совет**. Тестируйте на демо и используйте небольшие объёмы.

## Структура
```
.
├── .env.example
├── README.md
├── config.yaml
├── requirements.txt
└── src
    ├── exchanges.py
    ├── data.py
    ├── strategy.py
    ├── portfolio.py
    └── main.py
```
